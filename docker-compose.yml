services:
    app:
        build:
            context: .
            dockerfile: Dockerfile
        ports:
            - "8000:80"
        volumes:
            # Volume principal - todo o projeto
            - .:/var/www/html:cached
            # Volumes específicos para melhor performance
            - ./storage:/var/www/html/storage:delegated
            - ./bootstrap/cache:/var/www/html/bootstrap/cache:delegated
        environment:
            - APP_ENV=local
            - APP_DEBUG=true
            - APP_KEY=base64:om6FKmDMbsf9Jg0JJFjbbw3HVlSbK/Ed+mN/XtwbBJY=
            - APP_URL=http://localhost:8000
            - LOG_CHANNEL=stack
            - LOG_DEPRECATIONS_CHANNEL=null
            - LOG_LEVEL=debug
            - DB_CONNECTION=sqlite
            - DB_DATABASE=/var/www/html/database/database.sqlite
            - BROADCAST_DRIVER=log
            - CACHE_DRIVER=file
            - FILESYSTEM_DISK=local
            - QUEUE_CONNECTION=sync
            - SESSION_DRIVER=file
            - SESSION_LIFETIME=120
        networks:
            - laravel
        container_name: dailylaravel_app
        restart: unless-stopped
        command: ["apache2-foreground"]

    # Serviço opcional para desenvolvimento com Vite (hot reload)
    vite:
        build:
            context: .
            dockerfile: Dockerfile
        volumes:
            - .:/var/www/html:cached
        ports:
            - "5173:5173"
        command: ["bash", "-c", "npm install && npm run dev"]
        networks:
            - laravel
        container_name: dailylaravel_vite
        depends_on:
            - app
        profiles:
            - dev

networks:
    laravel:
        driver: bridge
